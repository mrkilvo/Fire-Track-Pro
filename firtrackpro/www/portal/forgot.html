{% extends "firtrackpro/www/templates/portal_template.html" %}

{% block title %}Forgot Password | FireTrack Pro{% endblock %}

{% block page_content %}
  {{ super() }}
  <div class="min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-indigo-500 via-pink-200 to-pink-500 dark:from-slate-900 dark:to-indigo-900">
    <div class="flex flex-col w-full max-w-md mx-4 sm:mx-auto p-6 sm:p-10 rounded-2xl bg-white/90 dark:bg-slate-900 shadow-2xl border border-indigo-200 dark:border-slate-800">
      <div class="flex flex-col items-center mb-6">
        <img src="/assets/firtrackpro/images/firetrack-logo.svg" alt="FireTrack Pro" class="w-16 h-16 mb-2 rounded-xl shadow-xl bg-white/90 dark:bg-slate-800 border border-indigo-200 dark:border-slate-700">
        <h1 class="text-xl sm:text-2xl font-extrabold text-indigo-600 dark:text-indigo-200 mb-1 mt-2">Reset your password</h1>
        <p class="text-sm text-gray-500 dark:text-gray-400 text-center">Enter your account email and we’ll send you a link to reset your password.</p>
      </div>
      <form id="reset-form" method="POST" action="/api/method/frappe.core.doctype.user.user.reset_password" class="flex flex-col gap-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        <div>
          <label for="user" class="block text-gray-700 dark:text-gray-300 font-semibold mb-1">Email</label>
          <input class="w-full px-4 py-3 rounded-xl border border-indigo-300 dark:border-slate-700 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-indigo-500 text-base"
                 name="user" id="user" type="email" autocomplete="username" required>
        </div>
        <button type="submit" class="w-full py-3 mt-1 bg-indigo-600 text-white font-bold rounded-xl shadow hover:bg-indigo-700 text-lg transition">Send Reset Link</button>
        <div id="reset-message" class="text-center font-semibold mt-1 hidden"></div>
      </form>
      <div class="flex justify-between mt-6 text-sm">
        <a href="/portal/login" class="text-gray-400 hover:underline">← Back to login</a>
        <a href="/" class="text-gray-400 hover:underline">Back to site</a>
      </div>
    </div>
  </div>
{% endblock %}

{% block footer_scripts %}
  {{ super() }}
  <script>
    document.getElementById('reset-form').onsubmit = async function(e) {
      e.preventDefault();
      let form = this;
      let data = new FormData(form);
      let btn = form.querySelector("button[type=submit]");
      let msgBox = document.getElementById("reset-message");
      msgBox.classList.add("hidden");
      btn.disabled = true;
      btn.textContent = "Sending...";
      try {
        let res = await fetch(form.action, {
          method: "POST",
          body: data,
          credentials: "same-origin"
        });
        let result = await res.json();
        if (result.message && result.message.indexOf("sent") > -1) {
          msgBox.textContent = "If your email is registered, a reset link has been sent.";
          msgBox.className = "text-green-600 text-center font-semibold mt-1";
        } else if (result.message) {
          msgBox.textContent = result.message;
          msgBox.className = "text-yellow-600 text-center font-semibold mt-1";
        } else {
          throw new Error("Could not process your request. Please try again.");
        }
      } catch (err) {
        msgBox.textContent = err.message;
        msgBox.className = "text-red-500 text-center font-semibold mt-1";
      }
      msgBox.classList.remove("hidden");
      btn.disabled = false;
      btn.textContent = "Send Reset Link";
    };
  </script>
{% endblock %}
