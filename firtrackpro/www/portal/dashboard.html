{% extends "firtrackpro/www/templates/portal_template.html" %}

{% block page_content %}
  {{ super() }}

  <div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4">
      <div>
        <h1 class="text-2xl font-bold text-gray-900">Welcome, {{ frappe.session.user_fullname or 'User' }}!</h1>
        <p class="text-gray-500 text-sm">Role: {{ ', '.join(user_roles) }}</p>
      </div>
      <div class="flex gap-2 mt-2 md:mt-0">
        <a href="/portal/accounts/profile" class="btn btn-sm bg-blue-600 text-white rounded shadow hover:bg-blue-700 transition">Profile</a>
        <a href="/portal/settings" class="btn btn-sm bg-gray-200 text-gray-800 rounded shadow hover:bg-gray-300 transition">Settings</a>
      </div>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="bg-white rounded-lg shadow p-4 flex flex-col items-center animate-fade-in">
        <i data-feather="briefcase" class="text-blue-600 w-6 h-6 mb-2"></i>
        <div class="text-2xl font-bold">{{ jobs_count or 0 }}</div>
        <div class="text-xs text-gray-500">Jobs (Today)</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4 flex flex-col items-center animate-fade-in">
        <i data-feather="list" class="text-green-600 w-6 h-6 mb-2"></i>
        <div class="text-2xl font-bold">{{ open_tasks or 0 }}</div>
        <div class="text-xs text-gray-500">Open Tasks</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4 flex flex-col items-center animate-fade-in">
        <i data-feather="calendar" class="text-purple-600 w-6 h-6 mb-2"></i>
        <div class="text-2xl font-bold">{{ upcoming_appointments or 0 }}</div>
        <div class="text-xs text-gray-500">Appointments</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4 flex flex-col items-center animate-fade-in">
        <i data-feather="alert-circle" class="text-red-600 w-6 h-6 mb-2"></i>
        <div class="text-2xl font-bold">{{ incidents or 0 }}</div>
        <div class="text-xs text-gray-500">Incidents</div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="flex flex-wrap gap-2 mt-4">
      <a href="/portal/jobs/new" class="btn bg-blue-500 text-white rounded shadow hover:bg-blue-600 transition flex items-center gap-1"><i data-feather="plus"></i> New Job</a>
      <a href="/portal/tasks/new" class="btn bg-green-500 text-white rounded shadow hover:bg-green-600 transition flex items-center gap-1"><i data-feather="plus"></i> Add Task</a>
      <a href="/portal/incidents/new" class="btn bg-red-500 text-white rounded shadow hover:bg-red-600 transition flex items-center gap-1"><i data-feather="alert-circle"></i> Log Incident</a>
      <a href="/portal/documents/upload" class="btn bg-gray-500 text-white rounded shadow hover:bg-gray-600 transition flex items-center gap-1"><i data-feather="upload"></i> Upload Document</a>
    </div>

    <!-- Recent Activity -->
    <div class="bg-white rounded-lg shadow p-4 mt-4">
      <h2 class="text-lg font-semibold mb-2">Recent Activity</h2>
      <ul class="divide-y divide-gray-100">
        {% for activity in recent_activity or [] %}
        <li class="py-2 flex items-center gap-2">
          <i data-feather="{{ activity.icon or 'activity' }}" class="w-4 h-4 text-gray-400"></i>
          <span class="flex-1">{{ activity.text }}</span>
          <span class="text-xs text-gray-400">{{ activity.time }}</span>
        </li>
        {% else %}
        <li class="py-2 text-gray-400">No recent activity.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Upcoming Events -->
    <div class="bg-white rounded-lg shadow p-4 mt-4">
      <h2 class="text-lg font-semibold mb-2">Upcoming Events</h2>
      <ul class="divide-y divide-gray-100">
        {% for event in upcoming_events or [] %}
        <li class="py-2 flex items-center gap-2">
          <i data-feather="calendar" class="w-4 h-4 text-purple-400"></i>
          <span class="flex-1">{{ event.title }}</span>
          <span class="text-xs text-gray-400">{{ event.date }}</span>
        </li>
        {% else %}
        <li class="py-2 text-gray-400">No upcoming events.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Announcements -->
    <div class="bg-white rounded-lg shadow p-4 mt-4">
      <h2 class="text-lg font-semibold mb-2">Announcements</h2>
      <ul class="list-disc pl-5 text-gray-700">
        {% for note in announcements or [] %}
        <li>{{ note }}</li>
        {% else %}
        <li class="text-gray-400">No announcements.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}

{% block footer %}{{ super() }}{% endblock %}
