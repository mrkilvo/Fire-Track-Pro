{% extends "firtrackpro/www/templates/portal_template.html" %}
{% block page_content %}
<div class="w-full px-2 sm:px-4 mt-16">
  <div class="bg-white rounded-lg shadow p-6">
    <h1 class="text-2xl font-bold mb-4">Edit Client</h1>
    <form id="client-edit-form" method="post">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">
        <div>
          <label class="font-semibold">Name</label>
          <input type="text" name="customer_name" value="{{ client.customer_name or client.name }}" class="border px-3 py-2 rounded w-full" required />
        </div>
        <div>
          <label class="font-semibold">Type</label>
          <select name="customer_type" class="border px-3 py-2 rounded w-full" required>
            <option value="Company" {% if client.customer_type == 'Company' %}selected{% endif %}>Company</option>
            <option value="Individual" {% if client.customer_type == 'Individual' %}selected{% endif %}>Individual</option>
          </select>
        </div>
        <div>
          <label class="font-semibold">Group</label>
          <select name="customer_group" class="border px-3 py-2 rounded w-full" required>
            {% for group in client_groups %}
            <option value="{{ group.name }}" {% if client.customer_group == group.name %}selected{% endif %}>{{ group.name }}</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="font-semibold">Territory</label>
          <input type="text" name="territory" value="{{ client.territory }}" class="border px-3 py-2 rounded w-full" />
        </div>
        <div>
          <label class="font-semibold">Primary Address</label>
          <input type="text" name="primary_address" value="{{ client.primary_address or '' }}" class="border px-3 py-2 rounded w-full" />
        </div>
        <div>
          <label class="font-semibold">Primary Contact</label>
          <input type="text" name="primary_contact" value="{{ client.primary_contact or '' }}" class="border px-3 py-2 rounded w-full" />
        </div>
        <div>
          <label class="font-semibold">Credit Limit</label>
          <input type="number" step="0.01" name="credit_limit" value="{{ client.credit_limit or '' }}" class="border px-3 py-2 rounded w-full" />
        </div>
      </div>
      <div class="flex gap-2 mt-8">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700">Save</button>
        <a href="/portal/clients/view?name={{ client.name }}" class="bg-gray-200 text-gray-700 px-4 py-2 rounded shadow hover:bg-gray-300">Cancel</a>
      </div>
    </form>
    <!-- Toast Popup -->
    <div id="toast" class="fixed top-6 right-6 z-50 hidden bg-green-600 text-white px-4 py-2 rounded shadow"></div>
  </div>
</div>
<script>
  document.getElementById('client-edit-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);
    try {
      const response = await fetch(window.location.pathname + window.location.search, {
        method: 'POST',
        body: data
      });
      if (response.ok) {
        showToast('Client saved!');
        setTimeout(() => {
          window.location.href = '/portal/clients/view?name=' + encodeURIComponent(form.customer_name.value);
        }, 1200);
      } else {
        showToast('Error saving client', true);
      }
    } catch (err) {
      showToast('Error saving client', true);
    }
  });
  function showToast(msg, error) {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.className = 'fixed top-6 right-6 z-50 px-4 py-2 rounded shadow ' + (error ? 'bg-red-600' : 'bg-green-600') + ' text-white';
    toast.style.display = 'block';
    setTimeout(() => { toast.style.display = 'none'; }, 2000);
  }
</script>
{% endblock %}
